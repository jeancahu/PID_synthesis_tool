{% load i18n static %}<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="{% static 'pidtuningtool/css/tool_style.css' %}" media="screen"/>

    <title>PI/PID Tunning CGI tool web interface</title>
  </head>
  <body>

    <resultsbox>
      <parameters>
	<div>
	  <h2>Model parameters:</h2>

	  <div id="model_params">
	    <div class='number_space'>
	      <label>Fractional parameter</label>
	      <number_label>{{v_param}}</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Time Constant</label>
	      <number_label>{{T_param}}</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Process Gain</label>
	      <number_label>{{K_param}}</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Dead Time Constant</label>
	      <number_label>{{L_param}}</number_label>
	    </div>

	    <div class='number_space'>
	      <label>IAE Index</label>
	      <number_label>{{model_IAE}}</number_label>
	    </div>
	  </div>


	  <h2>Controller parameters:</h2>

	  <div id="controllers_params">

	    <div class='number_space'>
	      <label>Controller:</label>
	      <number_label id='controller_name'>-</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Proportional Gain</label>
	      <number_label id='kp_const'>-</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Integral Time</label>
	      <number_label id='ti_const'>-</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Derivative time</label>
	      <number_label id='td_const'>-</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Servo-control performance</label>
	      <number_label id='servo_iae'>-</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Regulatory performance</label>
	      <number_label id='reg_iae'>-</number_label>
	    </div>

	    <div class='number_space'>
	      <label>Overall performance</label>
	      <number_label id='total_iae'>-</number_label>
	    </div>

	  </div>
	</div>
      </parameters>

    <images_tag>

      <iframe id="response_graph" scrolling="no" src="{{iframe_plotly_close_loop}}"></iframe>

      <div id="keyboard">
	<button class='result_button' onclick='params_toggle("PI","1.4")'>PI, Ms=1.4</button>
	<button class='result_button' onclick='params_toggle("PI","2.0")'>PI, Ms=2.0</button>
	<button class='result_button' onclick='params_toggle("PID","1.4")'>PID, Ms=1.4</button>
	<button class='result_button' onclick='params_toggle("PID","2.0")'>PID, Ms=2.0</button>
	<button id='toggle_graph' class='result_button' onclick='toggle_iframe_src()'>y vs ym</button>
      </div>

      <script type="text/javascript">

	document.getElementById("toggle_graph").disabled = {{button_disable}};

	var controllers = [ {{controller_params}} ];
	var error_indexes = {{error_indexes}};
	var key = '';

	var iframe_src_model = false;

	function toggle_iframe_src()
	{
	    if (iframe_src_model)
	    {
		iframe_src_model = false;
		document.getElementById('toggle_graph').innerHTML = 'y vs ym';
		document.getElementById('response_graph').src = "{{iframe_plotly_close_loop}}";
	    } else {
		iframe_src_model = true;
		document.getElementById('toggle_graph').innerHTML = 'Close-Loop';
		document.getElementById('response_graph').src = "{{iframe_plotly_model_comparison}}";
	    }
	}

	function params_toggle(cnt, ms)
	{
	    for ( var element = 0; element<controllers.length; element++ ){
		console.log(controllers[element]);
		if ( controllers[element].type == cnt && controllers[element].ms == ms )
		{
		    key = cnt+'_'+ms.replace('.','_');

		    document.getElementById('controller_name').innerHTML = cnt+', Ms = '+ms;
		    document.getElementById('kp_const').innerHTML = controllers[element].kp;
		    document.getElementById('ti_const').innerHTML = controllers[element].ti;
		    document.getElementById('td_const').innerHTML = controllers[element].td;

		    document.getElementById('servo_iae').innerHTML = 'IAE = '+error_indexes['IAE_R_'+key];
		    document.getElementById('reg_iae').innerHTML = 'IAE = '+error_indexes['IAE_D_'+key];
		    document.getElementById('total_iae').innerHTML = 'IAE = '+error_indexes['IAE_T_'+key];
		    break;
		}
	    }
	}
      </script>
    </images_tag>
    </resultsbox>
  </body>
</html>
